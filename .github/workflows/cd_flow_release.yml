name: Prepare release
on:
  push:
    branches:
    - 'release/**'
jobs:
  job_compute_release_name:
    runs-on: ubuntu-18.04
    outputs:
      release_name: ${{ steps.step_compute_release_name.outputs.release_name }}
    steps:
      - id: step_compute_release_name
        env:
          GIT_REF: ${{ github.ref }}
        run: echo "::set-output name=release_name::${GIT_REF#refs/heads/release/}"

  job_generate_and_commit_changelog:
    needs: job_compute_release_name
    runs-on: ubuntu-18.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Generate changelog file
        uses: charmixer/auto-changelog-action@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN}}

      - name: Commit and push image descriptions
        uses: stefanzweifel/git-auto-commit-action@v4.1.4
        with:
          commit_message: Add changelog for ${{ needs.job_compute_release_name.outputs.release_name }}
